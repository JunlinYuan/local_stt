<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local STT</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">‚óâ</span>
                <span class="logo-text">LOCAL STT</span>
            </div>
            <div class="header-controls">
                <button class="theme-toggle" id="themeToggle" title="Toggle theme">
                    <span class="theme-icon">‚òæ</span>
                </button>
                <div class="status-badge" id="connectionStatus">
                    <span class="status-dot"></span>
                    <span>Connecting...</span>
                </div>
            </div>
        </header>

        <!-- Quick Access Bar (Vocabulary + Replacements) -->
        <nav class="quick-access-bar">
            <div class="quick-access-left">
                <div class="vocab-display" id="vocabToggle" title="Click to manage vocabulary (V)">
                    <span class="vocab-icon">‚óà</span>
                    <span class="vocab-label">VOCAB</span>
                    <span class="vocab-terms" id="vocabTerms">‚Äî</span>
                    <span class="vocab-count" id="vocabCount">0</span>
                    <kbd class="shortcut-hint">V</kbd>
                </div>
                <div class="replacements-toggle" id="replacementsToggle" title="Click to manage word replacements (R)">
                    <span class="replacements-icon">‚áÑ</span>
                    <span class="replacements-label">REPLACE</span>
                    <span class="replacements-count" id="replacementsCount">0</span>
                    <kbd class="shortcut-hint">R</kbd>
                </div>
            </div>
            <div class="quick-access-right">
                <div class="model-info">
                    <span class="model-name">large-v3</span>
                    <span class="lang-badge" id="langBadge">AUTO</span>
                </div>
            </div>
        </nav>

        <!-- Language Selector -->
        <section class="language-section">
            <div class="language-label">
                <span class="label-icon">‚óà</span>
                <span>LANGUAGE MODE</span>
            </div>
            <div class="language-selector" id="languageSelector">
                <button class="lang-btn active" data-lang="" data-name="Auto-Detect">
                    <span class="lang-indicator"></span>
                    <span class="lang-code">AUTO</span>
                    <kbd class="shortcut-hint lang-hint">A</kbd>
                </button>
                <button class="lang-btn" data-lang="en" data-name="English">
                    <span class="lang-indicator"></span>
                    <span class="lang-code">EN</span>
                    <kbd class="shortcut-hint lang-hint">E</kbd>
                </button>
                <button class="lang-btn" data-lang="fr" data-name="French">
                    <span class="lang-indicator"></span>
                    <span class="lang-code">FR</span>
                    <kbd class="shortcut-hint lang-hint">F</kbd>
                </button>
                <button class="lang-btn" data-lang="zh" data-name="Chinese">
                    <span class="lang-indicator"></span>
                    <span class="lang-code">‰∏≠Êñá</span>
                    <kbd class="shortcut-hint lang-hint">C</kbd>
                </button>
                <button class="lang-btn" data-lang="ja" data-name="Japanese">
                    <span class="lang-indicator"></span>
                    <span class="lang-code">Êó•Êú¨Ë™û</span>
                    <kbd class="shortcut-hint lang-hint">J</kbd>
                </button>
            </div>
            <div class="language-status" id="languageStatus">Auto-detect enabled</div>
        </section>

        <!-- Main Recording Interface -->
        <main class="main">
            <!-- Provider Toggle Row -->
            <div class="provider-row">
                <div class="provider-label">
                    <span class="label-icon">‚ö°</span>
                    <span>STT PROVIDER</span>
                </div>
                <div class="provider-toggle" id="providerToggle">
                    <!-- Buttons generated dynamically from schema -->
                </div>
            </div>

            <!-- Settings Row: Key Binding + Delays -->
            <div class="settings-row">
                <!-- Key Binding Toggle -->
                <div class="keybind-toggle" id="keybindToggle">
                    <button class="keybind-btn active" data-binding="ctrl_only" title="Left Ctrl Only">
                        <span class="keybind-keys">‚åÉ</span>
                    </button>
                    <button class="keybind-btn" data-binding="ctrl" title="Ctrl + Command">
                        <span class="keybind-keys">‚åÉ + ‚åò</span>
                    </button>
                    <button class="keybind-btn" data-binding="shift" title="Shift + Command">
                        <span class="keybind-keys">‚áß + ‚åò</span>
                    </button>
                </div>

                <!-- Clipboard Sync Delay Slider (before paste) -->
                <div class="delay-control" id="clipboardSyncControl">
                    <label class="delay-label" title="Delay after copying to clipboard before pasting">
                        <span class="delay-icon">üìã</span>
                        <span>Pre</span>
                    </label>
                    <div class="delay-slider">
                        <input type="range" id="clipboardSyncSlider" min="0" max="0.5" step="0.01" value="0.05">
                        <span class="delay-value" id="clipboardSyncValue">0.05s</span>
                    </div>
                </div>

                <!-- Paste Delay Slider (after paste) -->
                <div class="delay-control" id="pasteDelayControl">
                    <label class="delay-label" title="Delay after pasting before restoring clipboard">
                        <span class="delay-icon">‚è±</span>
                        <span>Post</span>
                    </label>
                    <div class="delay-slider">
                        <input type="range" id="pasteDelaySlider" min="0" max="0.5" step="0.01" value="0.05">
                        <span class="delay-value" id="pasteDelayValue">0.05s</span>
                    </div>
                </div>

                <!-- Volume Normalization Toggle -->
                <div class="normalize-control" id="normalizeControl">
                    <button type="button" class="normalize-btn active" id="normalizeToggle" title="Normalize audio volume (boost quiet, limit loud)">
                        <span class="normalize-icon">üîä</span>
                        <span class="normalize-label">NORM</span>
                    </button>
                </div>

                <!-- Focus-Follows-Mouse Control -->
                <div class="ffm-control" id="ffmControl">
                    <button type="button" class="ffm-toggle active" id="ffmToggle" title="Enable/disable mouse tracking for paste">
                        <span class="ffm-icon">üñ±Ô∏è</span>
                    </button>
                    <div class="ffm-mode-toggle" id="ffmModeToggle">
                        <button type="button" class="ffm-mode-btn active" data-mode="track_only" title="Track only: activate window at paste time">
                            <span class="mode-label">Track</span>
                        </button>
                        <button type="button" class="ffm-mode-btn" data-mode="raise_on_hover" title="Raise on hover: focus window as mouse moves">
                            <span class="mode-label">Raise</span>
                        </button>
                    </div>
                </div>

                <!-- Max Recording Duration Slider -->
                <div class="delay-control" id="maxRecordingControl">
                    <label class="delay-label" title="Maximum recording duration (safety timeout)">
                        <span class="delay-icon">‚è±</span>
                        <span>Max</span>
                    </label>
                    <div class="delay-slider">
                        <input type="range" id="maxRecordingSlider" min="30" max="300" step="30" value="240">
                        <span class="delay-value" id="maxRecordingValue">4m</span>
                    </div>
                </div>
            </div>

            <!-- Recording State -->
            <div class="recording-panel" id="recordingPanel">
                <div class="rec-indicator" id="recIndicator">
                    <div class="rec-ring"></div>
                    <div class="rec-core"></div>
                </div>
                <div class="rec-label" id="recLabel">READY</div>
                <div class="rec-hint" id="recHint">Hold Ctrl + Command to record</div>

                <!-- Volume Level Indicator (shown after transcription when normalization enabled) -->
                <div class="volume-indicator" id="volumeIndicator">
                    <div class="volume-label">VOLUME LEVELS</div>
                    <div class="volume-meters">
                        <div class="volume-meter-row">
                            <span class="volume-meter-label">Original</span>
                            <div class="volume-meter-bar">
                                <div class="volume-meter-fill" id="volumeOriginalFill"></div>
                            </div>
                            <span class="volume-meter-value" id="volumeOriginalValue">‚Äî</span>
                        </div>
                        <div class="volume-meter-row">
                            <span class="volume-meter-label">Normalized</span>
                            <div class="volume-meter-bar">
                                <div class="volume-meter-fill normalized" id="volumeNormalizedFill"></div>
                            </div>
                            <span class="volume-meter-value" id="volumeNormalizedValue">‚Äî</span>
                        </div>
                    </div>
                    <div class="volume-gain" id="volumeGain">Gain: +0.0dB</div>
                </div>
            </div>
        </main>

        <!-- Inline History Section -->
        <section class="history-section" id="historySection">
            <div class="history-section-header">
                <div class="history-section-title">
                    <span class="history-section-icon">‚ó∑</span>
                    <span>DICTATION HISTORY</span>
                    <span class="panel-count" id="historyPanelCount">0</span>
                </div>
                <div class="history-section-actions">
                    <button class="panel-action-btn" id="historyClearBtn" title="Clear all history">
                        <span>Clear All</span>
                    </button>
                </div>
            </div>
            <div class="history-search-row">
                <span class="history-search-icon">/</span>
                <input type="text"
                       id="historySearchInput"
                       class="history-search-input"
                       placeholder="Search history..."
                       autocomplete="off"
                       spellcheck="false">
                <span class="history-search-count" id="historySearchCount"></span>
                <button class="history-search-clear" id="historySearchClear" title="Clear search (Esc)">‚úï</button>
            </div>
            <div class="history-section-body">
                <div class="panel-items-list history-list" id="historyList">
                    <!-- History entries populated dynamically -->
                </div>
            </div>
            <div class="history-section-footer">
                <span class="history-hint">Click any entry to copy to clipboard</span>
                <span class="history-hint-sep">¬∑</span>
                <span class="history-hint">Press <kbd>/</kbd> to search</span>
            </div>
        </section>

        <!-- Full-Page Vocabulary Panel -->
        <div class="fullpage-overlay" id="vocabOverlay">
            <div class="fullpage-panel" id="vocabPanel">
                <div class="fullpage-panel-header">
                    <div class="fullpage-panel-title">
                        <span class="panel-icon">‚óà</span>
                        <span>VOCABULARY BANK</span>
                        <span class="panel-count" id="vocabPanelCount">0</span>
                    </div>
                    <button class="fullpage-panel-close" id="vocabPanelClose" title="Close (Esc)">
                        <span>‚úï</span>
                    </button>
                </div>
                <div class="fullpage-panel-body">
                    <!-- Add Word Input -->
                    <div class="vocab-add-row">
                        <input type="text"
                               id="vocabInput"
                               class="vocab-input"
                               placeholder="Add new word or phrase..."
                               autocomplete="off"
                               spellcheck="false">
                        <button class="vocab-add-btn" id="vocabAddBtn" title="Add word">+</button>
                    </div>
                    <!-- Word List -->
                    <div class="panel-items-grid vocab-grid" id="vocabList">
                        <!-- Words will be populated here -->
                    </div>
                </div>
                <div class="fullpage-panel-footer">
                    <span class="file-hint">
                        <span class="file-icon">üìÅ</span>
                        <span class="file-path">vocabulary.txt</span>
                    </span>
                </div>
            </div>
        </div>

        <!-- Full-Page Replacements Panel -->
        <div class="fullpage-overlay" id="replacementsOverlay">
            <div class="fullpage-panel" id="replacementsPanel">
                <div class="fullpage-panel-header">
                    <div class="fullpage-panel-title">
                        <span class="panel-icon">‚áÑ</span>
                        <span>WORD REPLACEMENTS</span>
                        <span class="panel-count" id="replacementsPanelCount">0</span>
                    </div>
                    <div class="panel-header-actions">
                        <button class="panel-toggle-btn active" id="replacementsEnabledToggle" title="Enable/disable replacements">
                            <span class="toggle-icon">‚úì</span>
                            <span class="toggle-label">Enabled</span>
                        </button>
                        <button class="fullpage-panel-close" id="replacementsPanelClose" title="Close (Esc)">
                            <span>‚úï</span>
                        </button>
                    </div>
                </div>
                <div class="fullpage-panel-body">
                    <!-- Add Replacement Input -->
                    <div class="replacement-add-row">
                        <input type="text"
                               id="replacementFromInput"
                               class="replacement-input"
                               placeholder="Replace this..."
                               autocomplete="off"
                               spellcheck="false">
                        <span class="replacement-arrow">‚Üí</span>
                        <input type="text"
                               id="replacementToInput"
                               class="replacement-input"
                               placeholder="With this..."
                               autocomplete="off"
                               spellcheck="false">
                        <button class="replacement-add-btn" id="replacementAddBtn" title="Add replacement">+</button>
                    </div>
                    <!-- Replacement List -->
                    <div class="panel-items-list replacement-list" id="replacementsList">
                        <!-- Replacements will be populated here -->
                    </div>
                </div>
                <div class="fullpage-panel-footer">
                    <span class="file-hint">
                        <span class="file-icon">üìÅ</span>
                        <span class="file-path">replacements.json</span>
                    </span>
                    <span class="replacement-hint">Case-insensitive, whole words only</span>
                </div>
            </div>
        </div>

        <!-- Console Panel -->
        <div class="console-panel" id="consolePanel">
            <div class="console-header" id="consoleHeader">
                <div class="console-title">
                    <span class="console-icon">‚¨¢</span>
                    <span>CONSOLE</span>
                    <span class="console-count" id="consoleCount">0</span>
                </div>
                <div class="console-actions">
                    <button class="console-btn" id="copyConsole" title="Copy all logs">‚éò</button>
                    <button class="console-btn" id="clearConsole" title="Clear">‚úï</button>
                    <button class="console-btn" id="toggleConsole" title="Toggle">‚ñº</button>
                </div>
            </div>
            <div class="console-body" id="consoleBody">
                <div class="console-logs" id="consoleLogs"></div>
            </div>
        </div>
    </div>

    <script src="/static/app.js?v=5"></script>
</body>
</html>
